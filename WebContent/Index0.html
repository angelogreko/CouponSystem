<!DOCTYPE html>
<html>
<head>
<meta charset="windows-1255">
<title>Coupon Client System</title>
 
<script type="text/javascript">
	function login(btn) {
		var formField = getFormField();
		btn.disabled = true;
		document.getElementById("statDiv").innerHTML = '<Loading>...</p>'
		sendForm(formFields);
	}

	function sendForm(formFields) {
		var AJAX = new XMLHttpRequest();
		AJAX.responseType = "json";
		AJAX.open("POST", 'http://localhost:8080/com.angelo.coupon/LoginServlet', true);
		AJAX.setRequestHeader("Content-type",
				"application/x-www-form-urlencoded");
		AJAX.onreadystatechange = function() {
			if (AJAX.readyState == 4) {
				processResponse(AJAX.response);
			}
		};
		AJAX.send(formFields);
	}

	function getFormFields() {
		var formElements = document.getElementById('loginForm').elements;
		var paramString = '';
		alert(formElements.length);
		for (var i = 0; i < formElements.length; i++) {
			paramString += formElements[i].name + '=' + formElements[i].value
					+ '&';
		}
		return paramString;

	}

	function processResponse(jsonObj) {
		var ret = jsonObj.respCode;
		if (ret == 'ok') {
			document.getElementById("mainView").innerHTML = '<p>Welcome!</p>';
		} else {
			document.getElementById("submitBtn").disabled = false;
			document.getElementById("statDiv").innerHTML = '<p><b>Login failed!</b></p>';
		}
	}
</script>

</head>
<body>
	<h1>Coupon Client System</h1>
	<hr>
	<div id="mainView">
		<form>
			<table>
				<tr>
					<td>User Name</td>
					<td><input name="userName"></td>
				</tr>
				<tr>
					<td>Password</td>
					<td><input name="password"></td>
				</tr>
				<tr>
					<td>Role</td>
					<td><select id="clientType">
							<option>Select...</option>
							<option>ADMIN</option>
							<option>COMPANY</option>
							<option>CUSTOMER</option>
					</select></td></tr>
				<tr>
					<td colspan="2"><input id="submitBtn" onclick="login(this)"
						type="button" value="Submit"></td>
				</tr>
			</table>
		</form>
		<div style="color: red" id="statDiv"></div>
	</div>
</body>
</html>